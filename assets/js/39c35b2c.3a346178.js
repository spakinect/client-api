"use strict";(globalThis.webpackChunkclient_api=globalThis.webpackChunkclient_api||[]).push([[782],{8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var s=t(6540);const r={},d=s.createContext(r);function i(e){const n=s.useContext(d);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(d.Provider,{value:n},e.children)}},8818:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"webhooks","title":"Webhook Events","description":"Spakinect can send webhook notifications to your system when specific events occur. This allows you to receive real-time updates about visits and treatments.","source":"@site/docs/webhooks.md","sourceDirName":".","slug":"/webhooks","permalink":"/client-api/webhooks","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"webhooks","title":"Webhook Events","sidebar_position":2}}');var r=t(4848),d=t(8453);const i={id:"webhooks",title:"Webhook Events",sidebar_position:2},o="Webhook Events",a={},l=[{value:"Configuration",id:"configuration",level:2},{value:"Webhook Security",id:"webhook-security",level:2},{value:"Supported Events",id:"supported-events",level:2},{value:"1. Visit Completed (<code>visit.completed</code>)",id:"1-visit-completed-visitcompleted",level:3},{value:"Payload Structure",id:"payload-structure",level:4},{value:"Payload Fields",id:"payload-fields",level:4},{value:"Example Handler (Node.js/Express)",id:"example-handler-nodejsexpress",level:4},{value:"2. Treatment Updated (<code>treatment.updated</code>)",id:"2-treatment-updated-treatmentupdated",level:3},{value:"Payload Structure",id:"payload-structure-1",level:4},{value:"Payload Fields",id:"payload-fields-1",level:4},{value:"Example Handler (Node.js/Express)",id:"example-handler-nodejsexpress-1",level:4},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Idempotency",id:"1-idempotency",level:3},{value:"2. Async Processing",id:"2-async-processing",level:3},{value:"3. Error Handling",id:"3-error-handling",level:3},{value:"4. Testing",id:"4-testing",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Not Receiving Webhooks?",id:"not-receiving-webhooks",level:3},{value:"Common Issues",id:"common-issues",level:3},{value:"Need Help?",id:"need-help",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"webhook-events",children:"Webhook Events"})}),"\n",(0,r.jsx)(n.p,{children:"Spakinect can send webhook notifications to your system when specific events occur. This allows you to receive real-time updates about visits and treatments."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsx)(n.p,{children:"To receive webhook notifications, you need to:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Contact the Spakinect team"})," to configure webhook URLs for your Client account"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Provide your endpoint URLs"})," for each event type you want to subscribe to"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Implement webhook handlers"})," that can receive and process POST requests from Spakinect"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"webhook-security",children:"Webhook Security"}),"\n",(0,r.jsx)(n.p,{children:"All webhook requests from Spakinect include:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Content-Type"}),": ",(0,r.jsx)(n.code,{children:"application/json"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"User-Agent"}),": ",(0,r.jsx)(n.code,{children:"Spakinect-Webhook/1.0"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Your webhook endpoint should:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Respond with a ",(0,r.jsx)(n.code,{children:"200 OK"})," status code to acknowledge receipt"]}),"\n",(0,r.jsx)(n.li,{children:"Process the webhook asynchronously to avoid timeouts"}),"\n",(0,r.jsx)(n.li,{children:"Implement retry logic in case of temporary failures on your end"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"supported-events",children:"Supported Events"}),"\n",(0,r.jsxs)(n.h3,{id:"1-visit-completed-visitcompleted",children:["1. Visit Completed (",(0,r.jsx)(n.code,{children:"visit.completed"}),")"]}),"\n",(0,r.jsx)(n.p,{children:"Triggered when a Good Faith Exam (GFE) visit is completed and all treatment decisions have been made."}),"\n",(0,r.jsx)(n.h4,{id:"payload-structure",children:"Payload Structure"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "event": "visit.completed",\n  "timestamp": 1714675200000,\n  "success": true,\n  "data": {\n    "location_id": "loc_12345",\n    "gfe_id": "gfe_abc123xyz789",\n    "status": "Completed",\n    "pdf_link": "https://example-cdn.com/gfe/gfe_abc123xyz789.pdf",\n    "requested_treatments": [\n      "Botox Injection",\n      "Dermal Filler"\n    ],\n    "approved_treatments": [\n      "Botox Injection"\n    ],\n    "conditionally_approved_treatments": [\n      "Dermal Filler"\n    ],\n    "deferred_treatments": [],\n    "patient_details": {\n      "name": "Jane Smith",\n      "first_name": "Jane",\n      "last_name": "Smith",\n      "email": "jane.smith@example.com"\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"payload-fields",children:"Payload Fields"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Field"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"event"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsxs)(n.td,{children:["Always ",(0,r.jsx)(n.code,{children:'"visit.completed"'})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"timestamp"})}),(0,r.jsx)(n.td,{children:"integer"}),(0,r.jsx)(n.td,{children:"Unix timestamp in milliseconds when the event occurred"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"success"})}),(0,r.jsx)(n.td,{children:"boolean"}),(0,r.jsx)(n.td,{children:"Indicates if the data retrieval was successful"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"data.location_id"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"The ID of the location where the visit took place"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"data.gfe_id"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Unique identifier for the GFE visit"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"data.status"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsxs)(n.td,{children:["Visit status (always ",(0,r.jsx)(n.code,{children:'"Completed"'})," for this event)"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"data.pdf_link"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"URL to download the GFE PDF (if available)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"data.requested_treatments"})}),(0,r.jsx)(n.td,{children:"array"}),(0,r.jsx)(n.td,{children:"List of treatment names originally requested"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"data.approved_treatments"})}),(0,r.jsx)(n.td,{children:"array"}),(0,r.jsx)(n.td,{children:"List of treatment names that were approved"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"data.conditionally_approved_treatments"})}),(0,r.jsx)(n.td,{children:"array"}),(0,r.jsx)(n.td,{children:"List of treatment names with conditional approval"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"data.deferred_treatments"})}),(0,r.jsx)(n.td,{children:"array"}),(0,r.jsx)(n.td,{children:"List of treatment names that were deferred"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"data.patient_details"})}),(0,r.jsx)(n.td,{children:"object"}),(0,r.jsx)(n.td,{children:"Patient information"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"data.patient_details.name"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Patient's full name"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"data.patient_details.first_name"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Patient's first name"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"data.patient_details.last_name"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Patient's last name"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"data.patient_details.email"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Patient's email address"})]})]})]}),"\n",(0,r.jsx)(n.h4,{id:"example-handler-nodejsexpress",children:"Example Handler (Node.js/Express)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"app.post('/webhooks/visit-completed', async (req, res) => {\n  try {\n    const { event, data } = req.body;\n    \n    // Verify event type\n    if (event !== 'visit.completed') {\n      return res.status(400).json({ error: 'Invalid event type' });\n    }\n    \n    // Process the webhook data\n    console.log(`Visit ${data.gfe_id} completed for location ${data.location_id}`);\n    console.log(`Approved treatments:`, data.approved_treatments);\n    \n    // Update your system with the results\n    await updateVisitInYourSystem(data);\n    \n    // Respond quickly to acknowledge receipt\n    res.status(200).json({ received: true });\n    \n  } catch (error) {\n    console.error('Webhook processing error:', error);\n    res.status(500).json({ error: 'Internal server error' });\n  }\n});\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h3,{id:"2-treatment-updated-treatmentupdated",children:["2. Treatment Updated (",(0,r.jsx)(n.code,{children:"treatment.updated"}),")"]}),"\n",(0,r.jsx)(n.p,{children:"Triggered when treatment information is updated in the Spakinect system (e.g., a new treatment is added, an existing treatment is modified, or a treatment is removed)."}),"\n",(0,r.jsx)(n.h4,{id:"payload-structure-1",children:"Payload Structure"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "event": "treatment.updated",\n  "timestamp": 1714675200000,\n  "success": true,\n  "data": {\n    "treatment_id": "treatment_001",\n    "treatment_name": "Botox Injection",\n    "action": "updated"\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"payload-fields-1",children:"Payload Fields"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Field"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"event"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsxs)(n.td,{children:["Always ",(0,r.jsx)(n.code,{children:'"treatment.updated"'})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"timestamp"})}),(0,r.jsx)(n.td,{children:"integer"}),(0,r.jsx)(n.td,{children:"Unix timestamp in milliseconds when the event occurred"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"success"})}),(0,r.jsx)(n.td,{children:"boolean"}),(0,r.jsx)(n.td,{children:"Indicates if the update was successful"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"data.treatment_id"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Unique identifier for the treatment"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"data.treatment_name"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Name of the treatment"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"data.action"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsxs)(n.td,{children:["Type of update: ",(0,r.jsx)(n.code,{children:'"created"'}),", ",(0,r.jsx)(n.code,{children:'"updated"'}),", or ",(0,r.jsx)(n.code,{children:'"deleted"'})]})]})]})]}),"\n",(0,r.jsx)(n.h4,{id:"example-handler-nodejsexpress-1",children:"Example Handler (Node.js/Express)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"app.post('/webhooks/treatment-updated', async (req, res) => {\n  try {\n    const { event, data } = req.body;\n    \n    // Verify event type\n    if (event !== 'treatment.updated') {\n      return res.status(400).json({ error: 'Invalid event type' });\n    }\n    \n    // Process the webhook data based on action\n    switch (data.action) {\n      case 'created':\n        console.log(`New treatment added: ${data.treatment_name}`);\n        await addTreatmentToYourSystem(data);\n        break;\n      case 'updated':\n        console.log(`Treatment updated: ${data.treatment_name}`);\n        await updateTreatmentInYourSystem(data);\n        break;\n      case 'deleted':\n        console.log(`Treatment removed: ${data.treatment_name}`);\n        await removeTreatmentFromYourSystem(data);\n        break;\n    }\n    \n    // Respond quickly to acknowledge receipt\n    res.status(200).json({ received: true });\n    \n  } catch (error) {\n    console.error('Webhook processing error:', error);\n    res.status(500).json({ error: 'Internal server error' });\n  }\n});\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsx)(n.h3,{id:"1-idempotency",children:"1. Idempotency"}),"\n",(0,r.jsxs)(n.p,{children:["Your webhook handlers should be idempotent. Spakinect may send the same webhook multiple times in case of delivery failures or retries. Use the ",(0,r.jsx)(n.code,{children:"gfe_id"})," or ",(0,r.jsx)(n.code,{children:"treatment_id"})," along with the ",(0,r.jsx)(n.code,{children:"timestamp"})," to detect and ignore duplicate events."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"const processedEvents = new Set();\n\napp.post('/webhooks/visit-completed', async (req, res) => {\n  const eventKey = `${req.body.data.gfe_id}-${req.body.timestamp}`;\n  \n  if (processedEvents.has(eventKey)) {\n    return res.status(200).json({ received: true, duplicate: true });\n  }\n  \n  processedEvents.add(eventKey);\n  \n  // Process webhook...\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-async-processing",children:"2. Async Processing"}),"\n",(0,r.jsx)(n.p,{children:"Process webhooks asynchronously to ensure you respond quickly and avoid timeouts:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"app.post('/webhooks/visit-completed', async (req, res) => {\n  // Immediately acknowledge receipt\n  res.status(200).json({ received: true });\n  \n  // Process webhook asynchronously\n  processWebhookAsync(req.body).catch(error => {\n    console.error('Async webhook processing error:', error);\n    // Implement your own retry/error handling logic\n  });\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-error-handling",children:"3. Error Handling"}),"\n",(0,r.jsx)(n.p,{children:"Implement proper error handling and logging:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"app.post('/webhooks/visit-completed', async (req, res) => {\n  try {\n    // Validate payload\n    if (!req.body.data?.gfe_id) {\n      return res.status(400).json({ error: 'Missing gfe_id' });\n    }\n    \n    // Process webhook\n    await processWebhook(req.body);\n    \n    res.status(200).json({ received: true });\n    \n  } catch (error) {\n    // Log error with context\n    console.error('Webhook processing failed:', {\n      error: error.message,\n      event: req.body.event,\n      gfe_id: req.body.data?.gfe_id,\n      timestamp: new Date().toISOString()\n    });\n    \n    // Still acknowledge receipt to avoid retries\n    res.status(200).json({ received: true, error: true });\n  }\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-testing",children:"4. Testing"}),"\n",(0,r.jsx)(n.p,{children:"Test your webhook handlers in the staging environment before deploying to production. Contact the Spakinect team to configure test webhook URLs that point to your staging/development environment."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"not-receiving-webhooks",children:"Not Receiving Webhooks?"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Verify Configuration"}),": Contact Spakinect support to confirm your webhook URLs are correctly configured"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Check Endpoint Accessibility"}),": Ensure your webhook endpoint is publicly accessible and accepts POST requests"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Review Logs"}),": Check your server logs for incoming requests and any errors"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Test Manually"}),": Use tools like ",(0,r.jsx)(n.code,{children:"curl"})," or Postman to manually send test payloads to your endpoint"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Timeouts"}),": Ensure your webhook handler responds within 10 seconds"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"SSL/TLS Errors"}),": Make sure your webhook endpoint has a valid SSL certificate"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Firewall Rules"}),": Verify that your firewall allows incoming requests from Spakinect servers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Port Configuration"}),": Ensure your webhook endpoint is listening on the correct port (typically 443 for HTTPS)"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"need-help",children:"Need Help?"}),"\n",(0,r.jsx)(n.p,{children:"If you have questions about webhook implementation or need assistance with configuration, please contact the Spakinect support team."})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);