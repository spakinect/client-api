openapi: 3.0.3
info:
  title: Spakinect Client Integration API
  description: >-
    API for Client systems (medspas, clinics) to integrate with the Spakinect
    telemedicine platform. Provides endpoints for managing patient appointments,
    retrieving treatments, checking visit statuses, and configuring webhooks.
  version: 1.0.0
  contact:
    name: Spakinect Support
    email: support@spakinect.com
servers:
  - url: https://us-central1-spakinect-app.cloudfunctions.net/client
    description: Production Server
  - url: https://us-central1-spakinect-staging.cloudfunctions.net/client
    description: Staging Server
security:
  - ApiKeyAuth: []
paths:
  /appointments:
    post:
      summary: Create New Appointment
      description: >-
        Creates a new at-home appointment (Good Faith Exam) in the Spakinect
        system. Automatically handles patient creation or lookup based on
        provided details.
      operationId: createAppointment
      tags:
        - Appointments
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAppointmentRequest'
            examples:
              standard_appointment:
                summary: Standard appointment creation
                value:
                  patient_details:
                    first_name: John
                    last_name: Doe
                    email: john.doe@example.com
                    phone: '+1234567890'
                  location_id: loc_12345
                  appointment_time: 1640995200
                  requested_treatments:
                    - Botox Injection
                    - Dermal Filler
      responses:
        '201':
          description: Appointment created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateAppointmentResponse'
              examples:
                success:
                  summary: Successful appointment creation
                  value:
                    success: true
                    gfe_id: gfe_abc123xyz789
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /treatments:
    get:
      summary: Get Available Treatments
      description: >-
        Retrieves a list of all available treatments that can be requested in
        appointments.
      operationId: getTreatments
      tags:
        - Treatments
      responses:
        '200':
          description: List of available treatments
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TreatmentsResponse'
              examples:
                treatments_list:
                  summary: Available treatments
                  value:
                    data:
                      - id: treatment_001
                        name: Botox Injection
                      - id: treatment_002
                        name: Dermal Filler
                      - id: treatment_003
                        name: Chemical Peel
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /visits/{gfe_id}:
    get:
      summary: Get Visit Status
      description: >-
        Retrieves the current status and details of a Good Faith Exam (GFE)
        visit by ID. Only returns visits that the authenticated Client has
        access to based on location permissions. When the visit status is
        'Completed', the response includes decision outcomes mapped to treatment
        names: approved_treatments, conditionally_approved_treatments, and
        deferred_treatments.
      operationId: getVisitStatus
      tags:
        - Visits
      parameters:
        - name: gfe_id
          in: path
          required: true
          description: The unique identifier of the GFE visit
          schema:
            type: string
            example: gfe_abc123xyz789
      responses:
        '200':
          description: Visit status retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VisitStatusResponse'
              examples:
                completed_status:
                  summary: Completed visit
                  value:
                    success: true
                    data:
                      gfe_id: gfe_abc123xyz789
                      status: Completed
                      requested_treatments:
                        - Botox Injection
                        - Dermal Filler
                      approved_treatments:
                        - Botox Injection
                      conditionally_approved_treatments:
                        - Dermal Filler
                      deferred_treatments: []
                      patient_details:
                        name: Jane Smith
                        first_name: Jane
                        last_name: Smith
                        email: jane.smith@example.com
                processing_status:
                  summary: Visit in processing status
                  value:
                    success: true
                    data:
                      gfe_id: gfe_abc123xyz789
                      status: Processing
                      requested_treatments:
                        - Botox Injection
                        - Dermal Filler
                      patient_details:
                        name: John Doe
                        first_name: John
                        last_name: Doe
                        email: john.doe@example.com
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: x-api-key
      description: >-
        API key provided by Spakinect for Client integration. This key must be
        associated with at least one location that the Client system has access
        to.
  schemas:
    CreateAppointmentRequest:
      type: object
      required:
        - patient_details
        - location_id
        - appointment_time
        - requested_treatments
      properties:
        patient_details:
          $ref: '#/components/schemas/PatientDetails'
        location_id:
          type: string
          description: The ID of the location where the appointment will take place
          example: loc_12345
        appointment_time:
          type: integer
          description: Unix timestamp of the appointment date and time
          example: 1640995200
          minimum: 1
        requested_treatments:
          type: array
          description: List of treatment names requested for this appointment
          items:
            type: string
          minItems: 1
          example:
            - Botox Injection
            - Dermal Filler
      additionalProperties: false
    PatientDetails:
      type: object
      required:
        - first_name
        - last_name
        - email
        - phone
      properties:
        first_name:
          type: string
          description: Patient's first name
          example: John
          minLength: 1
          maxLength: 100
        last_name:
          type: string
          description: Patient's last name
          example: Doe
          minLength: 1
          maxLength: 100
        email:
          type: string
          format: email
          description: Patient's email address
          example: john.doe@example.com
        phone:
          type: string
          description: Patient's phone number
          example: '+1234567890'
          pattern: ^\+?[1-9]\d{1,14}$
      additionalProperties: false
    CreateAppointmentResponse:
      type: object
      required:
        - success
        - gfe_id
      properties:
        success:
          type: boolean
          description: Indicates if the appointment was created successfully
          example: true
        gfe_id:
          type: string
          description: Unique identifier for the created GFE appointment
          example: gfe_abc123xyz789
      additionalProperties: false
    TreatmentsResponse:
      type: object
      required:
        - data
      properties:
        data:
          type: array
          description: List of available treatments
          items:
            $ref: '#/components/schemas/Treatment'
      additionalProperties: false
    Treatment:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: string
          description: Unique identifier for the treatment
          example: treatment_001
        name:
          type: string
          description: Display name of the treatment
          example: Botox Injection
      additionalProperties: false
    VisitStatusResponse:
      type: object
      required:
        - success
        - data
      properties:
        success:
          type: boolean
          description: Indicates if the request was processed successfully
          example: true
        data:
          $ref: '#/components/schemas/VisitData'
      additionalProperties: false
    VisitData:
      type: object
      required:
        - gfe_id
        - status
        - requested_treatments
        - patient_details
      properties:
        gfe_id:
          type: string
          description: Unique identifier for the GFE visit
          example: gfe_abc123xyz789
        status:
          type: string
          description: Current status of the visit
          enum:
            - Processing
            - Pending Review
            - Approved
            - Completed
            - Cancelled
            - Rejected
          example: Processing
        requested_treatments:
          type: array
          description: List of treatments requested for this visit
          items:
            type: string
          example:
            - Botox Injection
            - Dermal Filler
        patient_details:
          $ref: '#/components/schemas/VisitPatientDetails'
        approved_treatments:
          type: array
          description: Present only when status is Completed. Names of treatments approved.
          items:
            type: string
          example:
            - Botox Injection
        conditionally_approved_treatments:
          type: array
          description: >-
            Present only when status is Completed. Names of treatments approved
            with conditions.
          items:
            type: string
          example:
            - Dermal Filler
        deferred_treatments:
          type: array
          description: Present only when status is Completed. Names of treatments deferred.
          items:
            type: string
          example: []
      additionalProperties: false
    VisitPatientDetails:
      type: object
      required:
        - name
        - first_name
        - last_name
        - email
      properties:
        name:
          type: string
          description: Patient's full name
          example: John Doe
        first_name:
          type: string
          description: Patient's first name
          example: John
        last_name:
          type: string
          description: Patient's last name
          example: Doe
        email:
          type: string
          format: email
          description: Patient's email address
          example: john.doe@example.com
      additionalProperties: false
    VisitCompletedWebhook:
      type: object
      title: Visit Completed Webhook
      description: >-
        Payload delivered to the Client webhook URL when a GFE visit is
        completed.
      required:
        - event
        - timestamp
        - success
        - data
      properties:
        event:
          type: string
          description: The webhook event type.
          enum:
            - visit.completed
          example: visit.completed
        timestamp:
          type: integer
          description: Unix timestamp (milliseconds) when the webhook was generated.
          example: 1714675200000
        success:
          type: boolean
          description: Indicates if the visit data retrieval was successful.
          example: true
        data:
          $ref: '#/components/schemas/VisitCompletedWebhookData'
      example:
        event: visit.completed
        timestamp: 1714675200000
        success: true
        data:
          location_id: loc_12345
          gfe_id: gfe_abc123xyz789
          status: Completed
          pdf_link: https://example-cdn.com/gfe/gfe_abc123xyz789.pdf
          requested_treatments:
            - Botox Injection
            - Dermal Filler
          approved_treatments:
            - Botox Injection
          conditionally_approved_treatments:
            - Dermal Filler
          deferred_treatments: []
          patient_details:
            name: Jane Smith
            first_name: Jane
            last_name: Smith
            email: jane.smith@example.com
    VisitCompletedWebhookData:
      type: object
      title: Visit Completed Webhook Data
      required:
        - location_id
        - gfe_id
        - status
        - requested_treatments
        - patient_details
      properties:
        location_id:
          type: string
          description: The ID of the location where the visit took place.
          example: loc_12345
        gfe_id:
          type: string
          description: Unique identifier for the GFE visit.
          example: gfe_abc123xyz789
        status:
          type: string
          description: Final status of the visit.
          enum:
            - Completed
          example: Completed
        pdf_link:
          type: string
          format: uri
          description: URL to the generated GFE PDF, if available.
          example: https://example-cdn.com/gfe/gfe_abc123xyz789.pdf
        requested_treatments:
          type: array
          description: List of treatments originally requested for this visit.
          items:
            type: string
          example:
            - Botox Injection
            - Dermal Filler
        patient_details:
          $ref: '#/components/schemas/VisitPatientDetails'
        approved_treatments:
          type: array
          description: >-
            Names of treatments approved by the provider. Present when status is
            Completed.
          items:
            type: string
          example:
            - Botox Injection
        conditionally_approved_treatments:
          type: array
          description: >-
            Names of treatments that are conditionally approved. Present when
            status is Completed.
          items:
            type: string
          example:
            - Dermal Filler
        deferred_treatments:
          type: array
          description: >-
            Names of treatments deferred to a later time. Present when status is
            Completed.
          items:
            type: string
          example: []
      additionalProperties: false
    TreatmentUpdatedWebhook:
      type: object
      title: Treatment Updated Webhook
      description: >-
        Payload delivered to the Client webhook URL when treatment information
        is updated.
      required:
        - event
        - timestamp
        - success
        - data
      properties:
        event:
          type: string
          description: The webhook event type.
          enum:
            - treatment.updated
          example: treatment.updated
        timestamp:
          type: integer
          description: Unix timestamp (milliseconds) when the webhook was generated.
          example: 1714675200000
        success:
          type: boolean
          description: Indicates if the update was successful.
          example: true
        data:
          type: object
          description: Treatment update details
          properties:
            treatment_id:
              type: string
              example: treatment_001
            treatment_name:
              type: string
              example: Botox Injection
            action:
              type: string
              enum:
                - created
                - updated
                - deleted
              example: updated
    ErrorResponse:
      type: object
      required:
        - success
        - error
      properties:
        success:
          type: boolean
          description: Always false for error responses
          example: false
        error:
          type: string
          description: Error message describing what went wrong
          example: Missing required patient details
        message:
          type: string
          description: Additional context about the error (optional)
          example: The first_name field is required but was not provided
      additionalProperties: false
  responses:
    BadRequest:
      description: Bad request - Invalid input parameters
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            missing_required_fields:
              summary: Missing required fields
              value:
                success: false
                error: Missing required patient details
            invalid_gfe_id:
              summary: Invalid GFE ID format
              value:
                success: false
                error: GFE ID is required
    Unauthorized:
      description: Unauthorized - Invalid or missing API key
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            missing_api_key:
              summary: Missing API key
              value:
                success: false
                error: 'Unauthorized: API key is missing.'
            invalid_api_key:
              summary: Invalid API key
              value:
                success: false
                error: 'Forbidden: Invalid API key.'
    Forbidden:
      description: Forbidden - Client not authorized for requested resource
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            location_access_denied:
              summary: No access to location
              value:
                success: false
                error: Client is not authorized for this location
            gfe_access_denied:
              summary: No access to GFE
              value:
                success: false
                error: Client is not authorized to access this GFE
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            gfe_not_found:
              summary: GFE not found
              value:
                success: false
                error: GFE not found
            location_not_found:
              summary: Location not found
              value:
                success: false
                error: Location not found
            client_not_found:
              summary: Client document not found
              value:
                success: false
                error: Not Found
                message: Client document not found
            endpoint_not_found:
              summary: Endpoint not found
              value:
                success: false
                error: Not found
                message: Client endpoint /invalid-path not found
    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            server_error:
              summary: Generic server error
              value:
                success: false
                error: Internal server error
  tags:
    - name: Appointments
      description: Operations for creating and managing Good Faith Exam appointments
    - name: Treatments
      description: Operations for retrieving available medical treatments
    - name: Visits
      description: Operations for checking visit status and details
  x-tagGroups:
    - name: API Endpoints
      tags:
        - Appointments
        - Treatments
        - Visits
    - name: Webhook Events
      tags: []
